{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="midnight">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yeskala Time Planner</title> 
    <style> 
        :root {
            /* Default (if no theme set) */
            --bg-body: radial-gradient(circle at top left, #020617 0%, #020617 45%, #000 100%); /* background main*/
            --bg-surface: rgba(15, 23, 42, 0.96); /* background surface */  
            --bg-card: #020617; /* background card */
            --bg-card-soft: #020617; /* background card */
            --border-subtle: rgba(148, 163, 184, 0.2); /* border */
            --accent: #0ea5e9; /* color accent */
            --accent-2: #6366f1; /* second color accent */
            --text-main: #e5e7eb; /* main text color */
            --text-muted: #9ca3af; /* muted text color */
            --btn-text: #020617; /* button text color */
            --pill-task-bg: rgba(34, 197, 94, 0.2); /* light green */
            --pill-task-border: #22c55e55; /* green border */
            --pill-task-text: #4ade80; /* green text */
            --pill-break-bg: rgba(250, 204, 21, 0.15); /* light yellow */
            --pill-break-border: #facc1544; /* yellow border */
            --pill-break-text: #facc15; /* yellow text */
        }



        /* Midnight Focus ‚Äì OG dark, a bit cooler now */
        html[data-theme="midnight"] { /* selected theme midnight */
            --bg-body: radial-gradient(circle at top left, #020617 0%, #020617 40%, #000 100%); /* background main */
            --bg-surface: rgba(15, 23, 42, 0.96); /* background surface */
            --bg-card: #020617; /* background card */
            --bg-card-soft: #020617; /* background card */
            --border-subtle: rgba(148, 163, 184, 0.35); /* border */
            --accent: #0ea5e9; /* color accent */
            --accent-2: #6366f1; /* second color accent */
            --text-main: #e5e7eb; /* main text color */
            --text-muted: #9ca3af; /* muted text color */
            --btn-text: #020617; /* button text color */
            --pill-task-bg: rgba(34, 197, 94, 0.18);  /* light green */
            --pill-task-border: rgba(34, 197, 94, 0.7); /* green border */
            --pill-task-text: #4ade80; /* green text */
            --pill-break-bg: rgba(250, 204, 21, 0.14); /* light yellow */
            --pill-break-border: rgba(250, 204, 21, 0.7); /* yellow border */
            --pill-break-text: #facc15; /* yellow text */
        }

        /* Neon Grid ‚Äì harsh contrast, cyberpunk glow */
        html[data-theme="neon"] { /* selected theme neon */
            --bg-body: /* background body: */
                radial-gradient(circle at top left, #020617 0%, #020617 40%, #020617 70%, #000 100%), /* background main */
                repeating-linear-gradient(to right,
                    rgba(34, 211, 238, 0.06) 0, /* linear gradient color 1 */
                    rgba(34, 211, 238, 0.06) 1px, /* linear gradient 2 */
                    transparent 1px, /* gradient color 1 opacity */
                    transparent 24px), /* gradient color 2 opacity */
                repeating-linear-gradient(to bottom,
                    rgba(232, 121, 249, 0.06) 0, /* linear gradient color 1 */
                    rgba(232, 121, 249, 0.06) 1px, /* linear gradient 2 */
                    transparent 1px, /* gradient color 1 opacity */
                    transparent 24px); /* gradient color 2 opacity */
            --bg-surface: rgba(2, 6, 23, 0.96); /* background surface color */
            --bg-card: rgba(3, 7, 18, 0.96); /* background card color */
            --bg-card-soft: #020617; /* background card color */
            --border-subtle: rgba(244, 114, 182, 0.55); /* border color */
            --accent: #22d3ee; /* color accent 1 */
            /* cyan */
            --accent-2: #e879f9; /* color accent 2 */ 
            /* neon pink */
            --text-main: #f9fafb; /* main text color */
            --text-muted: #a5b4fc; /* muted text color */
            --btn-text: #020617; /* button text color */
            --pill-task-bg: rgba(52, 211, 153, 0.3); /* light green */
            --pill-task-border: rgba(52, 211, 153, 0.9); /* green border */
            --pill-task-text: #bbf7d0; /* green text */
            --pill-break-bg: rgba(250, 204, 21, 0.26); /* light yellow */
            --pill-break-border: rgba(250, 204, 21, 0.9); /* yellow border */
            --pill-break-text: #feeaa3; /* yellow text */
        }

        /* Aurora Mist ‚Äì dreamy, soft gradient vibe */
        html[data-theme="aurora"] { /* selected theme aurora */
            --bg-body: radial-gradient(circle at top left, #020617 0%, #0f172a 30%, #1e293b 65%, #020617 100%); /* background main */
            --bg-surface: rgba(15, 23, 42, 0.97); /* background surface color */
            --bg-card: #020617; /* background card color */
            --bg-card-soft: #020617; /* background card color */
            --border-subtle: rgba(129, 140, 248, 0.5); /* border color */
            --accent: #22c55e; /* accent 1 color */
            /* green */
            --accent-2: #38bdf8; /* accent 2 color */
            /* light blue */
            --text-main: #e5e7eb; /* main text color */
            --text-muted: #9ca3af; /* muted text color */
            --btn-text: #020617; /* button text color */
            --pill-task-bg: linear-gradient(135deg, rgba(34, 197, 94, 0.23), rgba(56, 189, 248, 0.23)); /* light gradient green-blue */
            --pill-task-border: rgba(56, 189, 248, 0.9); /* green-blue border */
            --pill-task-text: #a5f3fc; /* green-blue text */
            --pill-break-bg: rgba(196, 181, 253, 0.2); /* light purple */
            --pill-break-border: rgba(196, 181, 253, 0.8); /* purple border */
            --pill-break-text: #e9d5ff; /* purple text */
        } 

        /* Solar Paper ‚Äì clean light theme */
        html[data-theme="solar"] { /* selected theme solar */
            --bg-body: radial-gradient(circle at top left, #fefce8 0%, #f4f4f5 40%, #e5e7eb 100%); /* background main */
            --bg-surface: #ffffff; /* background surface color */
            --bg-card: #f9fafb; /* background card color */
            --bg-card-soft: #ffffff; /* background card color */
            --border-subtle: rgba(148, 163, 184, 0.7); /* border color */
            --accent: #f97316; /* color accent 1 */
            /* orange */
            --accent-2: #22c55e; /* color accent 2 */
            /* green */
            --text-main: #0f172a; /* main text color */
            --text-muted: #6b7280; /* muted text color */
            --btn-text: #020617; /* button text color */
            --pill-task-bg: rgba(34, 197, 94, 0.14); /* light green */
            --pill-task-border: rgba(22, 163, 74, 0.7); /* green border */
            --pill-task-text: #15803d; /* green text */
            --pill-break-bg: rgba(251, 191, 36, 0.22); /* light orange */
            --pill-break-border: rgba(217, 119, 6, 0.8); /* orange border */
            --pill-break-text: #92400e; /* orange text */
        }

        /* Forest Study ‚Äì deep green library energy */
        html[data-theme="forest"] { /* selected theme forest */
            --bg-body: radial-gradient(circle at top left, #022c22 0%, #064e3b 35%, #020617 90%); /* background main */
            --bg-surface: rgba(6, 78, 59, 0.96); /* background surface color */
            --bg-card: #020617; /* background card color */
            --bg-card-soft: #020617; /* background card color */
            --border-subtle: rgba(52, 211, 153, 0.55); /* border color */
            --accent: #22c55e; /* accent 1 color */
            --accent-2: #16a34a; /* accent 2 color */
            --text-main: #ecfdf5; /* main text color */
            --text-muted: #6ee7b7; /* muted text color */
            --btn-text: #022c22;  /* button text color */
            --pill-task-bg: rgba(34, 197, 94, 0.26); /* light green */
            --pill-task-border: rgba(34, 197, 94, 0.95); /* green border */
            --pill-task-text: #bbf7d0; /* green text */
            --pill-break-bg: rgba(56, 189, 248, 0.2); /* light blue */
            --pill-break-border: rgba(56, 189, 248, 0.85); /* blue border */
            --pill-break-text: #7dd3fc; /* blue text */
        }


        html, 
        body,
        .container,
        .card,
        .textarea,
        .btn-primary,
        table,
        .pill,
        .schedule-time { /* Elements to apply transition */
            transition: 
                background 0.25s ease, 
                background-color 0.25s ease, 
                color 0.25s ease,
                border-color 0.25s ease,
                box-shadow 0.25s ease;
        }

        body { /* Body styles */
            margin: 0; 
            min-height: 100vh; 

            /* Fallback color (if the variable ever fails) */
            background-color: #020617; 

            /* Main themed background */
            background-image: var(--bg-body);

            background-repeat: no-repeat;
            background-size: cover; 
            background-attachment: fixed; 

            color: var(--text-main);
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; 
            display: flex; 
            justify-content: center; 
            padding: 1.5rem; 
        }

 
        @media (max-width: 768px) { 
            body {
                padding: 0.75rem;
            }
        }

        .container {
            width: 100%;
            max-width: 1120px;
            background: rgba(15, 23, 42, 0.55);
            border-radius: 1.25rem;
            border: 1px solid rgba(148, 163, 184, 0.15);
            padding: 1.75rem 1.75rem 2rem;
            box-shadow:
                0 22px 40px rgba(0, 0, 0, 0.7),
                0 0 0 1px rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(22px) ;
        }

        /* Top bar with title + theme switcher */
        .top-bar {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            align-items: flex-start;
            margin-bottom: 1.2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1.25rem 1rem 1.5rem;
                border-radius: 1rem;
            }
        }

        h1 {
            font-size: 1.9rem;
            margin: 0 0 0.25rem;
            letter-spacing: 0.02em;
        }

        .subtitle {
            color: var(--text-muted);
            margin: 0 0 1.5rem;
            font-size: 0.9rem;
        }

        .theme-switcher {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.25rem;
            font-size: 0.8rem;
        }

        .theme-switcher label {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
        }

        .theme-select {
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-main);
            border-radius: 999px;
            border: 1px solid rgba(55, 65, 81, 0.9);
            padding: 0.35rem 0.9rem;
            font-size: 0.8rem;
            outline: none;
            cursor: pointer;
            appearance: none;
            position: relative;
        }

        :root[data-theme="solar"] .theme-select {
            background: #f9fafb;
            color: #0f172a;
            border-color: rgba(148, 163, 184, 0.8);
        }

        .grid {
            display: grid;
            grid-template-columns: minmax(0, 1.05fr) minmax(0, 1.2fr);
            gap: 1.25rem;
        }

        @media (max-width: 900px) {
            .grid {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .card {
            background: radial-gradient(circle at top left, var(--bg-card) 0%, var(--bg-card-soft) 60%);
            border-radius: 0.9rem;
            border: 1px solid rgba(31, 41, 55, 0.9);
            padding: 1rem 1.15rem 1.15rem;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at top left, rgba(148, 163, 184, 0.12), transparent 55%);
            opacity: 0.7;
            pointer-events: none;
        }

        .card-inner {
            position: relative;
            z-index: 1;
        }

        .card h2 {
            font-size: 1rem;
            margin: 0 0 0.75rem;
            background: linear-gradient(90deg, var(--accent), transparent 80%);
            padding: 0.4rem 0.6rem;
            border-radius: 0.45rem;
            display: inline-block;
        }

        label {
            font-size: 0.8rem;
            color: #cbd5f5;
            display: block;
            margin-top: 0.5rem;
            margin-bottom: 0.1rem;
        }

        .textarea {
            width: 95%;
            margin-left: auto;
            margin-right: auto;
            display: block;
            background: rgba(15, 23, 42, 0.9);
            color: var(--text-main);
            border-radius: 0.6rem;
            border: 1px solid rgba(55, 65, 81, 0.9);
            padding: 0.6rem 0.7rem;
            margin-top: 0.15rem;
            font-size: 0.9rem;
            outline: none;
            resize: vertical;
            min-height: 220px;
            line-height: 1.4;
            transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
        }

        :root[data-theme="solar"] .textarea {
            background: #f9fafb;
            border-color: rgba(209, 213, 219, 0.9);
        }

        .textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 1px rgba(14, 165, 233, 0.5);
            background: rgba(15, 23, 42, 0.95);
        }

        :root[data-theme="solar"] .textarea:focus {
            background: #ffffff;
        }

        .hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--accent), var(--accent-2));
            color: var(--btn-text);
            border: none;
            padding: 0.6rem 1.35rem;
            border-radius: 999px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.8);
            transition: transform 0.1s ease, box-shadow 0.1s ease, filter 0.1s ease;
        }

        .btn-primary:hover {
            filter: brightness(1.05);
            transform: translateY(-1px);
            box-shadow: 0 16px 30px rgba(0, 0, 0, 0.9);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.9);
        }

        /* Card / border styling per theme */
        :root[data-theme="neon"] .card {
            border-color: rgba(244, 114, 182, 0.6);
            box-shadow: 0 18px 45px rgba(0, 0, 0, 0.9);
        }

        :root[data-theme="aurora"] .card {
            border-color: rgba(56, 189, 248, 0.5);
            box-shadow: 0 16px 40px rgba(15, 23, 42, 0.9);
        }

        :root[data-theme="solar"] .card {
            border-color: rgba(148, 163, 184, 0.6);
            box-shadow: 0 14px 30px rgba(15, 23, 42, 0.12);
        }

        :root[data-theme="forest"] .card {
            border-color: rgba(22, 163, 74, 0.7);
            box-shadow: 0 18px 40px rgba(2, 6, 23, 0.95);
        }

        /* Buttons per theme */
        :root[data-theme="solar"] .btn-primary {
            box-shadow: 0 10px 20px rgba(248, 174, 88, 0.4);
        }

        :root[data-theme="neon"] .btn-primary {
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.9);
        }

        /* Textarea per theme ‚Äì light vs dark handling */
        :root[data-theme="solar"] .textarea {
            background: #f9fafb;
            border-color: rgba(209, 213, 219, 0.9);
            color: #0f172a;
        }

        :root[data-theme="solar"] .textarea:focus {
            background: #ffffff;
        }

        /* Schedule rows per theme */
        :root[data-theme="solar"] tbody tr {
            background: #f9fafb;
            box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
        }

        :root[data-theme="solar"] tbody tr:hover {
            background: #ffffff;
        }

        :root[data-theme="neon"] tbody tr {
            background: radial-gradient(circle at top left, #020617, #020617 60%, #020617);
            box-shadow: 0 18px 40px rgba(0, 0, 0, 0.95);
        }


        .error {
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(248, 113, 113, 0.7);
            color: #fecaca;
            padding: 0.75rem 0.85rem;
            border-radius: 0.6rem;
            margin-bottom: 1rem;
            font-size: 0.83rem;
        }

        /* schedule table */
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 0.7rem;
            font-size: 0.86rem;
        }

        thead tr th {
            padding: 0.35rem 0.35rem 0.15rem;
            color: var(--text-muted);
            font-weight: 500;
            border-bottom: 1px solid rgba(31, 41, 55, 0.9);
            font-size: 0.78rem;
            text-transform: uppercase;
            letter-spacing: 0.09em;
        }

        tbody tr {
            background: #020617;
            border-radius: 0.9rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.75);
        }

        :root[data-theme="solar"] tbody tr {
            background: #f9fafb;
            box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
        }

        tbody tr:hover {
            background: #0a1224;
            transform: translateY(-2px);
        }

        :root[data-theme="solar"] tbody tr:hover {
            background: #ffffff;
        }

        tbody tr td {
            padding: 0.7rem 0.5rem;
            border-bottom: none;
            vertical-align: top;
        }

                tbody tr td:first-child { /* CSS: First cell in each table row (left column) */
            padding-left: 0.85rem; /* CSS: Extra left padding to separate time from edge */
            border-radius: 0.9rem 0 0 0.9rem; /* CSS: Round top-left and bottom-left corners */
            width: 115px; /* CSS: Fixed width for time column */
        }


        tbody tr td:last-child { /* CSS: Last cell in each table row (right column) */
            padding-right: 0.85rem; /* CSS: Extra right padding for spacing */
            border-radius: 0 0.9rem 0.9rem 0; /* CSS: Round top-right and bottom-right corners */
            width: 70px; /* CSS: Fixed width for importance column */
            text-align: center; /* CSS: Center text inside last cell */
        }


        tbody tr td:first-child::after { /* CSS: Decorative vertical separator after first cell */
            content: ""; /* CSS: Required for pseudo-element; empty string */
            position: absolute; /* CSS: Position relative to first cell */
            top: 0; /* CSS: Align to top of cell */
            right: -18px; /* CSS: Slightly outside the right edge of cell */
            bottom: 0; /* CSS: Stretch to bottom of cell */
            width: 2px; /* CSS: Thin separator line */
            background: linear-gradient(to bottom, rgba(14, 165, 233, 0.4), transparent); /* CSS: Vertical gradient line */
            border-radius: 999px; /* CSS: Fully rounded line ends */
        }


        .schedule-time { /* CSS: Badge styling for time range (e.g. 09:00 ‚Äì 10:00) */
            font-family: "JetBrains Mono", ui-monospace, SFMono-Regular, Menlo, Monaco; /* CSS: Monospace-like font for time */
            font-size: 0.8rem; /* CSS: Smaller text size */
            background: linear-gradient(135deg, var(--accent), var(--accent-2)); /* CSS: Diagonal accent gradient background */
            color: #f9fafb; /* CSS: Light text color for contrast */
            padding: 0.3rem 0.55rem; /* CSS: Vertical and horizontal padding around text */
            border-radius: 0.7rem; /* CSS: Rounded pill shape */
            font-weight: 600; /* CSS: Semi-bold time text */
            box-shadow: 0 0 12px rgba(14, 165, 233, 0.55); /* CSS: Glow effect around time badge */
            display: inline-flex; /* CSS: Inline flex for icon + text alignment */
            align-items: center; /* CSS: Vertically center content */
            gap: 0.25rem; /* CSS: Space between icon and text if present */
        }


        .pill { /* CSS: Generic pill style for labels (task type, importance, etc.) */
            display: inline-flex; /* CSS: Inline flex layout */
            align-items: center; /* CSS: Vertically center text */
            justify-content: center; /* CSS: Center content horizontally */
            padding: 0.18rem 0.65rem; /* CSS: Small vertical and horizontal padding */
            border-radius: 999px; /* CSS: Fully rounded pill shape */
            font-size: 0.75rem; /* CSS: Small label text */
            font-weight: 600; /* CSS: Semi-bold */
            margin-top: 0.3rem; /* CSS: Space above pill when under text */
        }


        .type-task { /* CSS: Pill variant for task-type labels (e.g. Must-do) */
            background: var(--pill-task-bg); /* CSS: Task pill background color from theme */
            color: var(--pill-task-text); /* CSS: Task pill text color */
            border: 1px solid var(--pill-task-border); /* CSS: Task pill border color */
        }


        .type-break { /* CSS: Pill variant for break-type labels */
            background: var(--pill-break-bg); /* CSS: Break pill background color from theme */
            color: var(--pill-break-text); /* CSS: Break pill text color */
            border: 1px solid var(--pill-break-border); /* CSS: Break pill border color */
        }


        .note { /* CSS: Styling for additional notes under tasks */
            color: var(--text-muted); /* CSS: Use muted text color from theme */
            font-size: 0.8rem; /* CSS: Small note text */
            margin-top: 0.4rem; /* CSS: Space above note */
            line-height: 1.35; /* CSS: Slightly relaxed line spacing */
            font-style: italic; /* CSS: Italic style to distinguish note text */
        }


        .fade-in { /* CSS: Utility class to apply fade-in animation */
            animation: fadeIn 0.45s ease forwards; /* CSS: Use fadeIn keyframes with easing and fill */
        }


        @keyframes fadeIn { /* CSS: Keyframes for fade-in + slide-up animation */
            from { /* CSS: Initial animation state */
                opacity: 0; /* CSS: Start fully transparent */
                transform: translateY(6px); /* CSS: Slightly shifted down */
            }


            to { /* CSS: Final animation state */
                opacity: 1; /* CSS: End fully visible */
                transform: translateY(0); /* CSS: Reset vertical position */
            }
        }


        tbody tr { /* CSS: Base styling for each schedule row */
            background: #020617; /* CSS: Dark row background */
            border-radius: 0.9rem; /* CSS: Rounded corners for row container */
            box-shadow: 0 5px 18px rgba(0, 0, 0, 0.65); /* CSS: Subtle drop shadow under each row */
            transition: background 0.15s ease, transform 0.15s ease; /* CSS: Smooth hover transitions for color and position */
        }


        tbody tr:hover { /* CSS: Hover state for table rows */
            background: #0a1224; /* CSS: Lighten/differentiate row background on hover */
            transform: translateY(-2px); /* CSS: Lift row slightly upward on hover */
        }


        @media (max-width: 500px) { /* CSS: Responsive adjustments for very small screens */
            .schedule-time { /* CSS: Shrink time badge on small screens */
                font-size: 0.7rem; /* CSS: Slightly smaller text */
                padding: 0.25rem 0.45rem; /* CSS: Reduced padding for compact fit */
            }


            tbody tr td { /* CSS: Cell padding adjustments on small screens */
                padding: 0.5rem 0.35rem; /* CSS: Reduce overall padding to fit narrow width */
            }
        }


        .card h2 { /* CSS: Card section title styling (for both left and right cards) */
            background: linear-gradient(90deg, var(--accent) 0%, transparent 80%); /* CSS: Title bar gradient highlight */
            padding: 0.4rem 0.6rem; /* CSS: Padding around the header text */
            border-radius: 0.45rem; /* CSS: Slight rounding of highlighted background */
        }


        tbody tr td:first-child { /* CSS: Override to make first cell a positioning context */
            position: relative; /* CSS: Required so ::after can be positioned absolutely inside */
        }


        tbody tr td:first-child::after { /* CSS: Second decorative separator variant (overrides previous for this layout) */
            content: ""; /* CSS: Empty pseudo-element for visual line */
            position: absolute; /* CSS: Position inside first cell */
            top: 0; /* CSS: Align at top */
            right: -20px; /* CSS: Slightly more offset than previous (-20px) */
            bottom: 0; /* CSS: Stretch to bottom */
            width: 2px; /* CSS: Thin vertical line */
            background: linear-gradient(to bottom, #0ea5e955, transparent); /* CSS: Gradient line using accent color */
            border-radius: 1px; /* CSS: Slight rounding for the edges of the line */
        }


        .coach-note { /* CSS: Container for coach note content (base dimensions/typography) */
            margin-top: 1rem; /* CSS: Space above coach note block */
            padding: 0.75rem 0.9rem; /* CSS: Internal padding */
            border-radius: 0.75rem; /* CSS: Rounded corners */
            font-size: 0.85rem; /* CSS: Slightly smaller text */
            line-height: 1.4; /* CSS: Comfortable line spacing */
        }


        .coach-note-label { /* CSS: Label/header inside coach note (e.g. "Yeskala Coach Note") */
            font-size: 0.8rem; /* CSS: Small label size */
            text-transform: uppercase; /* CSS: Make label text all caps */
            letter-spacing: 0.08em; /* CSS: Add letter spacing for a tag-like look */
            font-weight: 600; /* CSS: Semi-bold */
            margin-bottom: 0.3rem; /* CSS: Space below label before main text */
        }


        /* Default / dark themes */ /* CSS: Comment indicating default theme styling for coach-note */
        .coach-note { /* CSS: Dark-theme visual styling for coach note */
            border: 1px solid rgba(56, 189, 248, 0.4); /* CSS: Blue border */
            background: radial-gradient(circle at top left, rgba(8, 47, 73, 0.9), rgba(15, 23, 42, 0.95)); /* CSS: Radial dark gradient background */
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.85); /* CSS: Strong depth shadow */
            color: #e5e7eb; /* CSS: Light text color */
        }


        .coach-note-label { /* CSS: Label color in dark theme */
            color: #7dd3fc; /* CSS: Light blue label text */
        }


        /* Solar variant */ /* CSS: Comment for light-mode coach note styling */
        :root[data-theme="solar"] .coach-note { /* CSS: Coach note styling when Solar (light) theme is active */
            border-color: rgba(251, 191, 36, 0.7); /* CSS: Warm yellow border */
            background: linear-gradient(135deg, #fffbeb, #fefce8); /* CSS: Light, warm gradient background */
            box-shadow: 0 10px 20px rgba(15, 23, 42, 0.15); /* CSS: Softer shadow for light theme */
            color: #1f2937; /* CSS: Dark text color for readability */
        }


        :root[data-theme="solar"] .coach-note-label { /* CSS: Label color override for Solar theme */
            color: #92400e; /* CSS: Dark orange/brown label text */
        }


        .control-bar { /* CSS: Flex container for theme selector, preferences button, and music button */
            display: flex; /* CSS: Arrange children in a row */
            align-items: center; /* CSS: Vertically center items */
            gap: 1.2rem; /* CSS: Spacing between controls */
        }


        .theme-control { /* CSS: Container for theme label and select dropdown */
            display: flex; /* CSS: Flex layout */
            flex-direction: column; /* CSS: Stack label above select */
            align-items: flex-start; /* CSS: Align to left */
        }


        .control-label { /* CSS: Label text above theme select */
            font-size: 0.7rem; /* CSS: Small text */
            letter-spacing: 0.08em; /* CSS: Wider letter spacing */
            text-transform: uppercase; /* CSS: All caps label */
            color: var(--text-muted); /* CSS: Muted color from theme */
            margin-bottom: 0.25rem; /* CSS: Space between label and select */
        }


        /* Capsule-style selector */ /* CSS: Comment describing theme select design */
        .theme-select { /* CSS: Theme dropdown styling */
            background: rgba(255, 255, 255, 0.06); /* CSS: Semi-transparent background */
            color: var(--text-main); /* CSS: Use main text color */
            border: 1px solid rgba(255, 255, 255, 0.15); /* CSS: Light border */
            backdrop-filter: blur(6px); /* CSS: Glass effect blur */
            padding: 0.45rem 1rem; /* CSS: Padding around text */
            border-radius: 999px; /* CSS: Full pill shape */
            font-size: 0.85rem; /* CSS: Dropdown text size */
            cursor: pointer; /* CSS: Pointer cursor */
            transition: all 0.15s ease; /* CSS: Smooth transition for hover/focus */
        }


        .theme-select:hover { /* CSS: Hover state for theme dropdown */
            background: rgba(255, 255, 255, 0.12); /* CSS: Slightly brighter background on hover */
        }


        /* Fix dropdown options visibility */ /* CSS: Comment explaining reason for next rules */
        .theme-select option { /* CSS: Styling for options in dropdown (dark mode) */
            background-color: #111827; /* CSS: Dark background for option list */
            /* dark & matches theme */ /* CSS: Comment describing background */
            color: #e5e7eb !important; /* CSS: Force light text for readability */
            /* bright text */ /* CSS: Comment describing text */
            padding: 8px; /* CSS: Extra padding in dropdown items */
        }


        /* For light theme (Solar) */ /* CSS: Comment for Solar-specific option styling */
        html[data-theme="solar"] .theme-select option { /* CSS: Option styling in Solar theme */
            background-color: #ffffff; /* CSS: White background */
            color: #0f172a !important; /* CSS: Dark text for readability */
        }



        /* Preferences button */ /* CSS: Comment introducing preferences-btn style */
        .preferences-btn { /* CSS: Button-like link for opening preferences page */
            display: inline-flex; /* CSS: Inline flex for icon + text */
            align-items: center; /* CSS: Vertically center contents */
            gap: 0.35rem; /* CSS: Space between icon and text */
            padding: 0.45rem 1rem; /* CSS: Button padding */
            background: linear-gradient(to right, #22c55e33, #22c55e11); /* CSS: Soft green gradient with transparency */
            border: 1px solid #22c55e55; /* CSS: Semi-transparent green border */
            border-radius: 999px; /* CSS: Pill shape */
            font-weight: 600; /* CSS: Semi-bold text */
            color: #22c55e; /* CSS: Green text color */
            font-size: 0.85rem; /* CSS: Button text size */
            text-decoration: none; /* CSS: Remove underline */
            transition: 0.15s ease; /* CSS: Smooth hover transitions */
        }


        .preferences-btn:hover { /* CSS: Hover state for preferences button */
            background: linear-gradient(to right, #22c55e55, #22c55e22); /* CSS: Slightly stronger green gradient */
            transform: translateY(-1px); /* CSS: Lift effect on hover */
        }


        .preferences-btn .icon { /* CSS: Icon span inside preferences button */
            font-size: 1rem; /* CSS: Icon size */
        }


        .calendar-pill { /* CSS: Small pill buttons for calendar actions */
            display: inline-flex; /* CSS: Inline flex for icon + text */
            align-items: center; /* CSS: Vertically center contents */
            gap: 0.4rem; /* CSS: Space between icon and label */
            padding: 0.35rem 0.8rem; /* CSS: Inner padding */
            background: rgba(255, 255, 255, 0.07); /* CSS: Light translucent background */
            border: 1px solid var(--border-subtle); /* CSS: Use subtle border variable */
            border-radius: 999px; /* CSS: Pill shape */
            color: var(--text-main); /* CSS: Text color from theme */
            font-size: 0.85rem; /* CSS: Text size */
            text-decoration: none; /* CSS: Remove underline */
            backdrop-filter: blur(4px); /* CSS: Glass effect */
            transition: 0.15s ease; /* CSS: Smooth hover */
        }


        .calendar-pill:hover { /* CSS: Hover state for calendar pills */
            background: rgba(255, 255, 255, 0.12); /* CSS: Slightly brighter background */
            transform: translateY(-1px); /* CSS: Lift effect */
        }


        .saved-task-box label { /* CSS: Row styling for each saved-task checkbox item */
            display: flex; /* CSS: Flex layout */
            align-items: center; /* CSS: Vertically center checkbox + text */
            gap: 0.7rem; /* CSS: Space between checkbox and text */
            padding: 0.75rem 1rem; /* CSS: Internal padding */
            margin-bottom: 0.6rem; /* CSS: Space between items */
            border-radius: 10px; /* CSS: Rounded item corners */
            background: rgba(255, 255, 255, 0.04); /* CSS: Very subtle highlight background */
            border: 1px solid rgba(148, 163, 184, 0.25); /* CSS: Soft border */
            cursor: pointer; /* CSS: Pointer cursor on hover */
            transition: 0.2s ease; /* CSS: Smooth hover transitions */
        }


        .saved-task-box label:hover { /* CSS: Hover state for saved-task labels */
            background: rgba(255, 255, 255, 0.08); /* CSS: Brighten background slightly */
            border-color: var(--accent); /* CSS: Highlight border with accent color */
            transform: translateY(-2px); /* CSS: Lift effect */
        }


        .saved-task-box input[type="checkbox"] { /* CSS: Styling for checkboxes in saved-task list */
            transform: scale(1.2); /* CSS: Slightly enlarge checkbox */
            accent-color: var(--accent); /* CSS: Use accent color for checkbox tick/fill (supported browsers) */
        }


        .btn-small { /* CSS: Small gradient button (generic) */
            padding: 0.4rem 0.9rem; /* CSS: Inner padding */
            border-radius: 999px; /* CSS: Pill shape */
            font-size: 0.85rem; /* CSS: Small text size */
            font-weight: 600; /* CSS: Semi-bold text */
            text-decoration: none; /* CSS: No underline */
            background: linear-gradient(90deg, #0ea5e9, #6366f1); /* CSS: Blue-to-purple gradient */
            color: #0b1120; /* CSS: Dark text for contrast */
            transition: 0.15s ease; /* CSS: Smooth hover transition */
        }


        .btn-small:hover { /* CSS: Hover state for small button */
            filter: brightness(1.1); /* CSS: Slightly brighten on hover */
        }


        #fluid-canvas { /* CSS: Full-screen background canvas for fluid effect */
            position: fixed; /* CSS: Fix canvas relative to viewport */
            inset: 0; /* CSS: Top/right/bottom/left = 0; full-screen */
            width: 100vw; /* CSS: Full viewport width */
            height: 100vh; /* CSS: Full viewport height */
            z-index: -1; /* CSS: Place behind main content */
            pointer-events: none; /* CSS: Ignore mouse events so page is still clickable */
        }


        .calm-music-btn { /* CSS: Button for toggling calming music */
            margin-top: 0.8rem; /* CSS: Space above music button */
            padding: 0.55rem 1.2rem; /* CSS: Button padding */
            background: linear-gradient(to right, var(--accent), var(--accent-2)); /* CSS: Gradient using theme accents */
            border: none; /* CSS: Remove border */
            border-radius: 999px; /* CSS: Pill shape */
            color: var(--btn-text); /* CSS: Button text color variable */
            font-weight: 600; /* CSS: Semi-bold label */
            font-size: 0.85rem; /* CSS: Button text size */
            cursor: pointer; /* CSS: Pointer cursor */
            transition: 0.2s ease; /* CSS: Smooth hover/active transitions */
            box-shadow: 0 8px 18px rgba(0,0,0,0.4); /* CSS: Shadow for depth */
        }


        .calm-music-btn:hover { /* CSS: Hover state for music button */
            filter: brightness(1.08); /* CSS: Slight brighten effect */
            transform: translateY(-2px); /* CSS: Lift effect */
        }


        .calm-music-btn:active { /* CSS: Active/pressed state for music button */
            transform: translateY(0px); /* CSS: Return to original position */
        }




    </style> <!-- CSS: End of style block -->
</head> <!-- HTML: End of head section -->


<body> <!-- HTML: Start of page body -->
    <canvas id="fluid-canvas"></canvas> <!-- HTML: Canvas element used for animated fluid background -->
    <div class="container"> <!-- HTML: Main container for planner UI -->
        <div class="top-bar"> <!-- HTML: Top bar with title and controls -->
            <div> <!-- HTML: Left side of top bar (title + subtitle) -->
                <h1>Yeskala Time Planner</h1> <!-- HTML: Main page heading -->
                <p class="subtitle"> <!-- HTML: Subtitle under main heading -->
                    Describe yourself and your day in your own words. Yeskala will understand your tasks, mood, and
                    goals
                    and
                    build a full plan for today.
                    <!-- HTML: Subtitle explaining purpose of the planner -->
                </p> 
            </div> <!-- HTML: End of left side of top bar -->
            <div class="control-bar"> <!-- HTML: Right side of top bar (theme + prefs + music) -->


                <!-- Theme selector --> <!-- HTML comment: describes next block -->
                <div class="theme-control"> <!-- HTML: Wrapper for theme label + dropdown -->
                    <span class="control-label">Theme</span> <!-- HTML: Label above theme dropdown -->
                    <select id="theme-select" class="theme-select"> <!-- HTML: Theme selection dropdown -->
                        <option value="midnight">Midnight Focus</option> <!-- HTML: Theme option -->
                        <option value="neon">Neon Grid</option> <!-- HTML: Theme option -->
                        <option value="aurora">Aurora Mist</option> <!-- HTML: Theme option -->
                        <option value="solar">Solar Paper</option> <!-- HTML: Theme option -->
                        <option value="forest">Forest Study</option> <!-- HTML: Theme option -->
                    </select> <!-- HTML: End of theme selection dropdown -->
                </div> <!-- HTML: End of theme-control wrapper -->


                <!-- Preferences link --> <!-- HTML comment: explains preferences button -->
                <a href="{% url 'preferences' %}" class="preferences-btn"> 
                    <!-- HTML + Django: Link to preferences page -->
                    <span class="icon">‚öôÔ∏è</span> Preferences <!-- HTML: Icon and label inside link -->
                </a> <!-- HTML: End of preferences link -->


                <button id="calm-music-btn" class="calm-music-btn"> 
                    <!-- HTML: Button to toggle calming music -->
                    üéµ Play calming music <!-- HTML: Button label with icon -->
                </button> <!-- HTML: End of music button -->



            </div> <!-- HTML: End of control-bar div -->


        </div> <!-- HTML: End of top-bar div -->


        {% if error %} {# Django: If there is an error message in context #} <!-- HTML comment: indicates error display block -->
        <div class="error">{{ error }}</div> <!-- HTML + Django: Show error text -->
        {% endif %} {# Django: End if error #} <!-- HTML comment: end of error block -->


        <form method="post"> <!-- HTML: Main planner form using POST -->
            {% csrf_token %} {# Django: CSRF protection token #} <!-- HTML comment: CSRF token for security -->


            <div class="grid"> <!-- HTML: Two-column grid (left: description, right: schedule) -->
                <!-- Left: Free-text description --> <!-- HTML comment describing column -->
                <div class="card"> <!-- HTML: Card containing description and library tasks -->
                    <div class="card-inner"> <!-- HTML: Inner wrapper for card content -->
                        <h2>Tell Yeskala about you &amp; today</h2> <!-- HTML: Section heading (with &amp; for "&") -->


                        <label> <!-- HTML: Label wrapping textarea -->
                            <textarea class="textarea" name="description" 
                                placeholder="Example: 
I'm a Class 8 student. I slept late and I'm feeling a bit tired. I have Math homework (about 1 hour), Physics revision for a test tomorrow, 30 minutes of Hindi reading, and basketball practice in the evening from 6 to 7 PM. I usually focus better in the late morning and night, and I get stressed if I have too much back-to-back work. Please keep some breaks and don't put heavy study after 10 PM.">{{ form.description }}</textarea>
                            <!-- HTML + Django: Large textarea for user description; prefilled with form.description -->
                        </label> <!-- HTML: End of label for textarea -->
                        <div class="hint"> 
                            <!-- HTML: Hint text under textarea -->
                            You can include: how you feel, your tasks, deadlines, preferred times, breaks, exams,
                            sports,
                            anything.
                            <!-- HTML: Examples of what to write -->
                        </div>
                        <!-- Task Library Button --> <!-- HTML comment: next link opens task library -->
                        <div style="margin-top:1.2rem;"> <!-- HTML: Inline-styled spacer wrapper -->
                            <a href="{% url 'task_library' %}" style="
                                  padding:0.55rem 1rem;
                                  background:rgba(255,255,255,0.08);
                                  border:1px solid rgba(148,163,184,0.3);
                                  color:var(--text-main);
                                  border-radius:999px;
                                  font-size:0.9rem;
                                  text-decoration:none;
                                  backdrop-filter:blur(8px);
                                  display:inline-flex;
                                  gap:0.5rem;
                                  align-items:center; 
                               ">
                                <!-- HTML + Django: Styled pill link to task library -->
                                üìö Open Task Library <!-- HTML: Label with book emoji -->
                            </a> <!-- HTML: End of task library link -->
                        </div> <!-- HTML: End of spacer wrapper -->



                        <button type="submit" class="btn-primary">Generate AI Schedule</button> 
                        <!-- HTML: Submit button to generate schedule based on description + selected tasks -->
                    </div> <!-- HTML: End of card-inner div -->


                    <div class="saved-task-box"> <!-- HTML: Box listing saved tasks as quick-add checkboxes -->
                        <h3>Add Tasks From Library</h3> <!-- HTML: Subheading for saved tasks -->


                        {% for t in saved_tasks %} {# Django: Loop through each saved task #} <!-- HTML comment: start of saved task item -->
                        <label> 
                            <!-- HTML: Label for each checkbox task -->
                            <input type="checkbox" name="library_task_{{ t.id }}"> <!-- HTML + Django: Checkbox referencing task id -->
                            {{ t.name }} ({{ t.default_duration_minutes }}m) 
                            <!-- Django variables: Task name and default duration shown -->
                        </label><br> <!-- HTML: Line break after each task row -->
                        {% endfor %} {# Django: End saved_tasks loop #} <!-- HTML comment: end of saved task items -->
                    </div> <!-- HTML: End of saved-task-box div -->


                </div> <!-- HTML: End of left column card -->


                <!-- Right: Result schedule --> <!-- HTML comment: second column card -->
                <div class="card"> <!-- HTML: Card containing AI-generated schedule -->
                    <div class="card-inner"> <!-- HTML: Inner wrapper for schedule content -->
                        <h2>Today's AI Day Plan</h2> <!-- HTML: Section title -->
                        {% if mood %} {# Django: If mood object is present #} <!-- HTML comment: mood display block -->
                        <div style=" 
                                margin-top:0.6rem;
                                padding:0.5rem 0.8rem;
                                border-radius:999px;
                                display:inline-flex;
                                align-items:center;
                                gap:0.5rem;
                                font-size:0.85rem;
                                background:rgba(255,255,255,0.08);
                                border:1px solid rgba(148,163,184,0.3);
                            ">
                            <!-- HTML: Mood chip showing detected mood -->
                            üß† <strong>{{ mood.label|default:'Mood not detected'|capfirst }}</strong> 
                            <!-- Django: Show mood label or 'Mood not detected', capitalized -->
                            {% if mood.intensity %} {# Django: If intensity score exists #}
                            <span style="opacity:0.6;">(Intensity: {{ mood.intensity }}/10)</span>
                            <!-- HTML + Django: Show mood intensity score -->
                            {% endif %} 
                        </div>


                        {% if mood.reasoning %} {# Django: If mood has reasoning text #}
                        <div style=" 
                                margin-top:0.4rem;
                                font-size:0.75rem;
                                color:var(--text-muted);
                            ">
                            <!-- HTML: Small muted reasoning paragraph -->
                            {{ mood.reasoning }} <!-- Django: Explanation for detected mood -->
                        </div> <!-- HTML: End of reasoning div -->
                        {% endif %}
                        {% endif %}



                        {% if schedule %} {# Django: If an AI schedule has been generated #}
                        <p class="hint" style="margin-top: 0.9rem;"> 
                            <!-- HTML: Hint encouraging end-of-day reflection -->
                            At the end of your day, <a href="{% url 'planner_reflect' %}" style="color: #38bdf8;">add a
                                quick reflection</a>
                            so tomorrow's AI plan gets smarter.
                            <!-- HTML + Django: Link to reflection page -->
                        </p>
                        <div style="margin-top: 0.8rem; display: flex; flex-wrap: wrap; gap: 0.5rem;"> 
                            <!-- HTML: Small pill actions row -->
                            <a href="{% url 'export_ics' %}" class="calendar-pill"> 
                                <!-- Django: Link to download .ics file -->
                                 Add to Calendar (.ics) <!-- HTML: Label -->
                            </a>


                            <a href="{% url 'add_to_google_calendar' %}" class="calendar-pill" 
                                style="border-color:#22c55e;">
                                <!-- Django: Link for direct Google Calendar add -->
                                 Add directly to Google Calendar <!-- HTML: Label -->
                            </a> <!-- HTML: End of Google Calendar link -->




                        </div> <!-- HTML: End of pill actions row -->


                        <table> <!-- HTML: Schedule table -->
                            <thead> <!-- HTML: Table header -->
                                <tr> <!-- HTML: Header row -->
                                    <th style="width: 110px;">Time</th> <!-- HTML: Time column header -->
                                    <th>Task / Block</th> <!-- HTML: Task column header -->
                                    <th style="width: 80px;">Importance</th> <!-- HTML: Importance column header -->
                                </tr> <!-- HTML: End of header row -->
                            </thead> <!-- HTML: End of table header -->
                            <tbody> <!-- HTML: Table body for schedule items -->
                                {% for item in schedule %} {# Django: Loop through generated schedule items #}
                                <tr> <!-- HTML: Single schedule row -->
                                    <td> <!-- HTML: Time cell -->
                                        {% if item.start and item.end %} {# Django: If both start and end times exist #}
                                        <span class="schedule-time"> 
                                            <!-- HTML: Time badge -->
                                            {{ item.start }} - {{ item.end }} <!-- Django: Insert start and end times -->
                                        </span> <!-- HTML: End of time badge -->
                                        {% endif %}
                                    </td>
                                    <td> <!-- HTML: Task/Block cell -->
                                        <strong>{{ item.task|default:item.type|capfirst }}</strong><br>
                                        <!-- Django: Show explicit task name or fallback to type, capitalized -->
                                        {% if item.type %} {# If there is a type for this block #}
                                        <span class="pill type-{{ item.type }}">
                                            <!-- HTML + Django: Pill with class like type-task/type-break -->
                                            {{ item.type|capfirst }} <!-- Django: Label for type -->
                                        </span> <!-- HTML: End of type pill -->
                                        {% endif %}  
                                        {% if item.note %} {# If there is a note for this block #} 
                                        <div class="note">{{ item.note }}</div> <!-- HTML + Django: Show note below task -->
                                        {% endif %}
                                    </td>
                                    <td> <!-- HTML: Importance cell -->
                                        {% if item.importance is not none %} {# If importance is defined #}
                                        {% if item.importance == 3 %} {# Highest importance #} 
                                        <span class="pill type-task">Must-do</span> 
                                        {% elif item.importance == 2 %} {# Medium importance #}
                                        <span class="pill type-task">Should-do</span> 
                                        {% elif item.importance == 1 %} {# Lowest importance #}
                                        <span class="pill type-task">Nice-to-have</span> 
                                        {% else %} {# Fallback case, often used for break #}
                                        <span class="pill type-break">Break</span> 
                                        {% endif %}
                                        {% endif %}
                                    </td> <!-- HTML: End of importance cell -->
                                </tr> <!-- HTML: End of schedule row -->
                                {% endfor %} {# Django: End schedule loop #}
                            </tbody> <!-- HTML: End of table body -->
                        </table> <!-- HTML: End of schedule table -->


                        {% if coach_note %} {# Django: If there is a coach_note text from backend #}
                        <div style="
                            margin-top: 1rem;
                            padding: 0.75rem 0.9rem;
                            border-radius: 0.75rem;
                            border: 1px solid rgba(56,189,248,0.4);
                            background: radial-gradient(circle at top left, rgba(8,47,73,0.9), rgba(15,23,42,0.95));
                            box-shadow: 0 12px 25px rgba(0,0,0,0.85);
                            font-size: 0.85rem;
                            line-height: 1.4;
                        ">
                            <!-- HTML: Styled outer wrapper for coach note -->
                            <div class="coach-note">
                                <!-- HTML: Inner coach-note block -->
                                <div class="coach-note-label">
                                    Yeskala Coach Note <!-- HTML: Label/title of note -->
                                </div>
                                <div class="coach-note-body">
                                    {{ coach_note }} <!-- Django: Insert generated coach note -->
                                </div> <!-- HTML: End of coach-note-body div -->
                            </div> <!-- HTML: End of coach-note div -->
                        </div> <!-- HTML: End of outer wrapper for coach note -->
                        {% endif %}


                        <div style="margin-top: 1.2rem;"> 
                            <!-- HTML: CTA to reflection page -->
                            <a href="{% url 'planner_reflect' %}" style="
                                   display: inline-block;
                                   padding: 0.55rem 1.1rem;
                                   background: linear-gradient(to right, var(--accent), var(--accent-2));
                                   color: var(--btn-text);
                                   border-radius: 999px;
                                   font-weight: 600;
                                   font-size: 0.85rem;
                                   text-decoration: none;
                                   box-shadow: 0 10px 22px rgba(0,0,0,0.45);
                               ">
                                End of Day Reflection <!-- HTML: Button-style link label -->
                            </a> <!-- HTML: End of reflection link -->
                        </div> <!-- HTML: End of CTA wrapper -->



                        {% else %} {# Django: If no schedule is generated yet #} <!-- HTML comment: no schedule block -->
                        <p class="hint">Your personalized schedule will appear here after you submit your description.
                        </p> <!-- HTML: Instruction to submit description first -->
                        {% endif %} 
                    </div> <!-- HTML: End of card-inner div -->
                </div> <!-- HTML: End of right column card -->
            </div> <!-- HTML: End of grid div -->
        </form> <!-- HTML: End of main form -->
    </div> <!-- HTML: End of main container div -->
    <script> /* JS: Script to handle calming music play/pause */
        (function () { /* JS: IIFE to avoid polluting global scope */
            const btn = document.getElementById("calm-music-btn"); /* JS: Get reference to music button */


            const audio = new Audio("{% static 'planner/audio/calm.mp3' %}"); /* JS + Django: Create audio object using static file URL */
            audio.loop = true; /* JS: Enable looping playback */


            let isPlaying = false; /* JS: Track whether music is currently playing */


            btn.addEventListener("click", () => { /* JS: Toggle music on button click */
                if (!isPlaying) { /* JS: If not playing, start music */
                    audio.play(); /* JS: Start playback */
                    isPlaying = true; /* JS: Update state */
                    btn.textContent = "‚èπ Stop music"; /* JS: Change button label to stop state */
                } else { /* JS: If currently playing, stop music */
                    audio.pause(); /* JS: Pause playback */
                    audio.currentTime = 0; /* JS: Reset audio to beginning */
                    isPlaying = false; /* JS: Update state */
                    btn.textContent = "üéµ Play calming music"; /* JS: Change button label back to play state */
                }
            });
        })();
    </script> <!-- JS: End of calming music script -->



    <script> /* JS: Script for animated fluid background on #fluid-canvas */
        (function () { /* JS: IIFE for encapsulation */
            const canvas = document.getElementById("fluid-canvas"); /* JS: Canvas element reference */
            const ctx = canvas.getContext("2d"); /* JS: 2D drawing context */


            let width, height, dpr; /* JS: Track canvas dimensions and device pixel ratio */


            function resize() { /* JS: Adjust canvas size to current viewport */
                dpr = window.devicePixelRatio || 1; /* JS: Get device pixel ratio (fallback 1) */
                width = window.innerWidth; /* JS: Current viewport width */
                height = window.innerHeight; /* JS: Current viewport height */
                canvas.width = width * dpr; /* JS: Set canvas internal width scaled by dpr */
                canvas.height = height * dpr; /* JS: Set canvas internal height scaled by dpr */
                ctx.scale(dpr, dpr); /* JS: Scale drawing context for high DPI */
            }
            window.addEventListener("resize", resize); /* JS: Recalculate on window resize */
            resize(); /* JS: Initial sizing call */


            // each "blob" is a fluid splash
            let blobs = []; /* JS: Array to store active blobs */
            let hue = 0; /* JS: Base hue for HSLA color cycling */


            window.addEventListener("mousemove", (e) => { /* JS: Add new blob where mouse moves */
                blobs.push({
                    x: e.clientX, /* JS: Blob x-position (mouse X) */
                    y: e.clientY, /* JS: Blob y-position (mouse Y) */
                    r: 0, /* JS: Initial radius */
                    alpha: 1 /* JS: Initial opacity */
                });
            });


            function draw() { /* JS: Main animation loop */
                // fade old frame ‚Üí fluid effect
                ctx.fillStyle = "rgba(0, 0, 0, 0.10)"; /* JS: Semi-transparent black overlay to fade previous frame */
                ctx.fillRect(0, 0, width, height); /* JS: Cover entire canvas for fade effect */


                hue = (hue + 1.5) % 360; /* JS: Increment hue for rainbow color cycling */


                for (let i = blobs.length - 1; i >= 0; i--) { /* JS: Loop through blobs in reverse to allow removal */
                    const b = blobs[i]; /* JS: Current blob */


                    // color changes smoothly ‚Üí rainbow
                    const color = `hsla(${hue}, 90%, 60%, ${b.alpha})`; /* JS: HSLA color based on current hue and blob alpha */


                    ctx.beginPath(); /* JS: Start new drawing path */
                    ctx.fillStyle = color; /* JS: Set fill color */
                    ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2); /* JS: Draw a circle at blob position with radius r */
                    ctx.fill(); /* JS: Fill the circle */


                    // blob physics ‚Üí expansion + fade
                    b.r += 2.5; /* JS: Increase blob radius each frame (expansion) */
                    b.alpha -= 0.015; /* JS: Reduce opacity each frame (fade out) */


                    if (b.alpha <= 0) blobs.splice(i, 1); /* JS: Remove blob when fully transparent */
                }


                requestAnimationFrame(draw); /* JS: Schedule next frame for smooth animation */
            }


            draw(); /* JS: Kick off the animation loop */
        })();
    </script> <!-- JS: End of fluid background script -->




    <script> /* JS: Theme persistence logic using localStorage */
        (function () { /* JS: IIFE to keep variables scoped */
            const select = document.getElementById('theme-select'); /* JS: Theme dropdown element */
            const root = document.documentElement; /* JS: <html> root element for data-theme attribute */
            const STORAGE_KEY = 'ai-planner-theme'; /* JS: Key name used in localStorage */


            // Load saved theme
            const saved = localStorage.getItem(STORAGE_KEY); /* JS: Read saved theme from localStorage */
            if (saved) { /* JS: If a theme value was saved */
                root.setAttribute('data-theme', saved); /* JS: Apply theme to <html> via data-theme */
                if (select) select.value = saved; /* JS: Sync dropdown to saved theme */
            }


            if (select) { /* JS: Only add listener if dropdown exists */
                select.addEventListener('change', function () { /* JS: On user changing theme */
                    const val = this.value; /* JS: Selected theme value */
                    root.setAttribute('data-theme', val); /* JS: Set new theme on <html> */
                    localStorage.setItem(STORAGE_KEY, val); /* JS: Persist theme choice in localStorage */
                });
            }
        })();
    </script> <!-- JS: End of theme persistence script -->
</body> <!-- HTML: End of body -->


</html> <!-- HTML: End of document -->
